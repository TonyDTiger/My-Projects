# Quadcopter Equations of Motion

This repository provides a reference implementation of the **nonlinear** and **linearized** equations of motion (EoMs) for a quadcopter. The models are suitable for simulation, control design, and analysis of quadrotor dynamics.

---

## Overview

A quadcopter is a 6-DOF rigid body with four independent rotors. Its dynamics can be split into:

- **Translational dynamics** (position and velocity in 3D space).
- **Rotational dynamics** (attitude and angular rates).
- **Control inputs** (thrusts generated by each rotor).

We model the system in the **body frame** (attached to the quadcopter) and express its motion relative to an **inertial frame** (Earth-fixed, North-East-Down).

<img width="678" height="519" alt="quadcopter_body_frame" src="https://github.com/user-attachments/assets/acc8e89d-00f6-4bd6-8ddf-cec0407c2fc2" />

---

## State and System Parameter Definition

We define the state vector:

$$
\mathbf{x} =
\begin{bmatrix}
x & y & z & u & v & w & \phi & \theta & \psi & p & q & r
\end{bmatrix}^T
$$

where:
- $x,y,z$: position in inertial frame
- $u,v,w$: body-frame velocities
- $\phi, \theta, \psi$: roll pitch, yaw (Euler angles, Z-Y-X convention)
- $p,q,r$: body-frame angular rates

Mass properties of the quadcopter are: mass $m$ and principal moments of inertia $I_x,I_y,I_z$. Gravitational acceleration constant is represented as: $g$

---

## Control Inputs

- Each rotor produces thrust $f_i$ along the body $+z_b$ axis (opposing gravity when pitched/rolled to tilt the thrust vector).
- Arm length from the CG to each rotor is $l$.
- Reaction torques (about $z_b$) due to rotor drag use $k_m$ and the spin pattern above:

$$
\tau_z = k_m\,(f_1 - f_2 + f_3 - f_4)
$$

---

## Nonlinear Equations of Motion

### Translational Dynamics (body-frame)

Let $F_z = f_1 + f_2 + f_3 + f_4$

Then, 

$$
\begin{aligned}
\dot{u} &= rv - qw + g\sin\theta
          + \frac{F_z}{m}\big(\cos\phi\,\sin\theta\,\cos\psi + \sin\phi\,\sin\psi\big)\\
\dot{v} &= pw - ru - g\sin\phi\cos\theta
          + \frac{F_z}{m}\big(\cos\phi\,\sin\theta\,\sin\psi - \sin\phi\,\cos\psi\big)\\
\dot{w} &= qu - pv - g\cos\phi\cos\theta
          + \frac{F_z}{m}\big(\cos\phi\,\cos\theta\big)
\end{aligned}
$$

### Rotational Dynamics

Moments from individual thrusts:

$$
\begin{aligned}
M_x &= l*(f_4 - f_2),\\
M_y &= l*(f_3 - f_1),\\
M_z &= k_m * (f_1 - f_2 + f_3 - f_4)
\end{aligned}
$$

Rigid-body rotational dynamics:

$$
\begin{aligned}
\dot{p} &= \frac{I_y - I_z}{I_x}\,qr + \frac{M_x}{I_x}\\
\dot{q} &= \frac{I_z - I_x}{I_y}\,pr + \frac{M_y}{I_y}\\
\dot{r} &= \frac{I_x - I_y}{I_z}\,pq + \frac{M_z}{I_z}
\end{aligned}
$$

### Kinematics (Euler ZYX)

$$
\begin{bmatrix}\dot{\phi} \\\ \dot{\theta} \\\ \dot{\psi}\end{bmatrix} = \begin{bmatrix}
1 & \sin\phi\tan\theta & \cos\phi\tan\theta\\
0 & \cos\phi & -\sin\phi\\
0 & \sin\phi/\cos\theta & \cos\phi/\cos\theta\end{bmatrix}
\begin{bmatrix} p \\\ q \\\ r \end{bmatrix}
$$

---

## Linearization About Hover

Hover equilibrium:

$$
\phi=\theta=0,\; u=v=w=0,\; p=q=r=0,\; f_1^\star=f_2^\star=f_3^\star=f_4^\star=\frac{mg}{4}.
$$

Define small thrust perturbations $\Delta f_i = f_i - f_i^\star$ and small angles/rates. The leading-order (small-angle) channels:

$$
\begin{aligned}
\Delta \dot{x} &\approx \Delta u,\quad \dot{y}\approx \Delta v,\quad \dot{z}\approx \Delta w \\
\Delta \dot{u} &\approx g* \Delta \theta, \\
\Delta \dot{v} &\approx -g* \Delta \phi, \\
\Delta \dot{w} &\approx \frac{1}{m}\,(\Delta f_1+\Delta f_2+\Delta f_3+\Delta f_4), \\
\Delta \dot{p} &\approx \frac{l}{I_x}\,(\Delta f_4 - \Delta f_2), \\
\Delta \dot{q} &\approx \frac{l}{I_y}\,(\Delta f_3 - \Delta f_1), \\
\Delta \dot{r} &\approx \frac{k_m}{I_z}\,(\Delta f_1 - \Delta f_2 + \Delta f_3 - \Delta f_4), \\
\Delta \dot{\phi} &\approx \Delta p,\quad \dot{\theta}\approx \Delta q,\quad \dot{\psi}\approx \Delta r
\end{aligned}
$$

This yields a linear state-space model with input vector 

$$
\mathbf{u} =
\begin{bmatrix}\Delta f_1 & \Delta f_2 & \Delta f_3 & \Delta f_4\end{bmatrix}^T.
$$

---

Here $F_z$ is the total body $+z_b$ thrust.


The resulting **linearized dynamics** capture the small-angle motion and are suitable for LQR, PID, or other linear controllers.
